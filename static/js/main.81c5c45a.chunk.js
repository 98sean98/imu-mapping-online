(this["webpackJsonpimu-mapping-online"]=this["webpackJsonpimu-mapping-online"]||[]).push([[0],{29:function(e,t,a){},46:function(e,t){},53:function(e,t,a){"use strict";a.r(t);var n=a(2),c=a.n(n),s=a(23),i=(a(29),a(3)),r={shouldCorrectWithBiasRotM:!0,frequency:50,assumedConstantVelocity:.15,biasTimeCutOff:[0,30],timeCutOff:[30,60]},l={zipFile:void 0,setZipFile:function(){},rotationMatrixData:void 0,setRotationMatrixData:function(){},generatedDisplacement:void 0,setGeneratedDisplacement:function(){},dataRevision:0,setDataRevision:function(){},algorithmParameters:r,setAlgorithmParameters:function(){}},o=Object(n.createContext)(l),u=function(){return Object(n.useContext)(o)},d=a(0),j=function(){var e=u(),t=e.zipFile,a=e.setZipFile,c=Object(n.useState)(!1),s=Object(i.a)(c,2),r=s[0],l=s[1],o=Object(n.useState)(0),j=Object(i.a)(o,2),f=j[0],b=j[1];return Object(d.jsxs)("div",{className:"w-full h-64 border-2 border-gray-600 border-dashed rounded-lg flex flex-col items-center justify-center text-center relative overflow-hidden",onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),l(!0),b((function(e){return e+1}))},onDragLeave:function(e){e.preventDefault(),e.stopPropagation();var t=f-1;0===t&&l(!1),b(t)},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},onDrop:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&(a(e.dataTransfer.files[0]),e.dataTransfer.clearData(),b(0)),l(!1)},children:[r?Object(d.jsx)("div",{className:"absolute inset-0 z-10 bg-gray-300 bg-opacity-75 flex items-center justify-center",children:Object(d.jsx)("p",{children:"Drop me!"})}):null,Object(d.jsxs)("p",{className:"font-medium text-gray-400",children:["undefined"!==typeof t?"".concat(t.name):"Drop a .zip file"," "]}),Object(d.jsxs)("div",{className:"mt-3",children:[Object(d.jsx)("label",{htmlFor:"file",className:"text-xs button cursor-pointer",children:"undefined"===typeof t?"Choose a file":"Choose another file"}),Object(d.jsx)("input",{id:"file",className:"hidden",type:"file",onChange:function(e){null!=e.target.files&&a(e.target.files[0])}})]})]})},f=a(15),b=a.n(f),m=a(20),O=a(24),p=a.n(O),x=a(55),h=function(){var e=u(),t=e.zipFile,a=e.setRotationMatrixData,c=e.setGeneratedDisplacement,s=Object(n.useState)([]),r=Object(i.a)(s,2),l=r[0],o=r[1];return Object(n.useEffect)((function(){"undefined"!==typeof t&&(new p.a).loadAsync(t).then(function(){var e=Object(m.a)(b.a.mark((function e(t){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(t.files).map(function(){var e=Object(m.a)(b.a.mark((function e(t){var a;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.async("text");case 2:return a=e.sent,e.abrupt("return",{name:t.name,date:t.date,content:a});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:a=e.sent,o(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[t]),Object(n.useEffect)((function(){if("undefined"!==typeof l){var e=l.find((function(e){return e.name.includes("matrix.csv")}));if("undefined"!==typeof e){var t=e.content.split("\n");t.splice(0,1),t.splice(t.length-1,1);for(var n=[],s=[],i=t.length,r=0;r<i;r++){var o=t.splice(0,1)[0].split(",").map((function(e){return parseFloat(e)}));n.push(o.splice(0,1)[0]);for(var u=[],d=0;d<3;d++){var j=o.splice(0,3);u.push(j)}s.push(Object(x.e)(u))}a({time:n,rotationMatrix:s}),c(void 0)}}}),[l,a,c]),Object(d.jsx)(d.Fragment,{})},y=a(7),v=function(){var e=u(),t=e.rotationMatrixData,a=e.setGeneratedDisplacement,c=e.setDataRevision,s=e.algorithmParameters,i=Object(n.useCallback)((function(){if("undefined"!==typeof t){var e=t.time,n=t.rotationMatrix,i=s.shouldCorrectWithBiasRotM,r=s.frequency,l=s.assumedConstantVelocity,o=s.biasTimeCutOff,u=s.timeCutOff,d=Object(x.f)(o,r),j=n.slice(d[0],d[1]),f=j.reduce((function(e,t){return Object(x.a)(e,t)}),Object(x.k)(3,3)),b=Object(x.b)(f,j.length),m=Object(x.d)(b),O=Object(x.i)(m,Object(x.c)(2,[0,1,2]),[0,0,1]);console.log({meanStationaryRotM:b,inverseMeanStationaryRotM:m,biasCorrectionRotM:O});for(var p=e.findIndex((function(e){return e>u[0]})),h=e.findIndex((function(e){return e>u[1]}),p),v=e.slice(p,h),g=n.slice(p,h),C=Object(x.j)(v,v[0]),N=C.map((function(e,t){return.5*(l+l)*(e-(t>0?C[t-1]:0))})),D=[],z=0;z<g.length;z++)if(0!==z){var F=D[z-1],w=N[z],M=g[z],R=i?Object(x.f)(O,M):M,S=Object(x.f)(R,Object(x.e)([[w],[0],[0]])),P=Object(x.a)(F,S);D.push(P)}else D.push(Object(x.e)([[0],[0],[0]]));for(var T=Object(x.e)([]),A=0;A<D.length;A++){var E=C[A],k=D[A].toArray().flat();k[1]=-1*k[1];var B=Object(x.e)([E].concat(Object(y.a)(k)));T.subset(Object(x.c)(A,Object(x.g)(0,4)),B)}a(T),c((function(e){return e+1}))}}),[t,s,a,c]);return Object(d.jsx)(d.Fragment,{children:"undefined"!==typeof t?Object(d.jsx)("button",{className:"button",onClick:i,children:"Run Algorithm"}):null})},g=a(16),C=a.n(g),N=function(){var e=u(),t=e.generatedDisplacement,a=e.dataRevision,c=Object(n.useMemo)((function(){return"undefined"!==typeof t}),[t]),s=Object(n.useMemo)((function(){if("undefined"!==typeof t){var e=t.size()[0];return{t:Object(x.i)(t,Object(x.c)(Object(x.g)(0,e),0)).toArray().flat(),x:Object(x.i)(t,Object(x.c)(Object(x.g)(0,e),1)).toArray().flat(),y:Object(x.i)(t,Object(x.c)(Object(x.g)(0,e),2)).toArray().flat(),z:Object(x.i)(t,Object(x.c)(Object(x.g)(0,e),3)).toArray().flat()}}return{t:[],x:[],y:[],z:[]}}),[t]);return Object(d.jsx)(d.Fragment,{children:c?Object(d.jsxs)("div",{className:"flex flex-col items-center space-y-8 px-4",children:[Object(d.jsx)("div",{className:"w-full md:w-4/5 lg:w-3/5",children:Object(d.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:s.t,y:s.x,type:"scatter",mode:"lines",line:{color:"red"},name:"x"},{x:s.t,y:s.y,type:"scatter",mode:"lines",line:{color:"blue"},name:"y"},{x:s.t,y:s.z,type:"scatter",mode:"lines",line:{color:"green"},name:"z"}],layout:{autosize:!0,title:"Dynamics"}})}),Object(d.jsxs)("div",{className:"w-full lg:flex lg:justify-around space-y-4 lg:space-x-4 lg:space-y-0",children:[Object(d.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:s.y,y:s.x,type:"scatter",mode:"lines",line:{color:"red"}}],layout:{autosize:!0,title:"2D Map",xaxis:{autorange:!1}}}),Object(d.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:s.x,y:s.z,type:"scatter",mode:"lines",line:{color:"blue"}}],layout:{autosize:!0,title:"Elevation",yaxis:{autorange:!1}}})]}),Object(d.jsx)("div",{className:"w-full md:w-4/5 lg:w-3/5",children:Object(d.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:s.y,y:s.x,z:s.z,type:"scatter3d",mode:"lines",line:{color:"red",width:4}}],layout:{autosize:!0,title:"3D Map",scene:{camera:{eye:{x:-1.25,y:-1.25,z:1.25}},aspectmode:"cube",dragmode:!1}}})})]}):null})},D=a(5),z=function(e){return isNaN(e)?"":e},F=function(){var e=u(),t=e.algorithmParameters,a=e.setAlgorithmParameters;return Object(d.jsxs)("div",{className:"space-y-4",children:[Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"shouldCorrectWithBiasRotM",children:"Should correct bias"}),Object(d.jsx)("input",{id:"shouldCorrectWithBiasRotM",type:"checkbox",checked:t.shouldCorrectWithBiasRotM,onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{shouldCorrectWithBiasRotM:e.target.checked}))}})]}),Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"frequency",children:"Data collection frequency (Hz)"}),Object(d.jsx)("input",{id:"frequency",type:"number",min:1,max:400,value:z(t.frequency),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{frequency:parseInt(e.target.value)}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"assumedConstantVelocity",children:"Assumed constant velocity (m/s)"}),Object(d.jsx)("input",{id:"assumedConstantVelocity",type:"number",min:0,value:z(t.assumedConstantVelocity),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{assumedConstantVelocity:parseFloat(e.target.value)}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("p",{children:"Bias time cut off (seconds)"}),Object(d.jsxs)("div",{className:"mt-2 flex space-x-4",children:[Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"biasTimeCutOffStart",children:"Start"}),Object(d.jsx)("input",{id:"biasTimeCutOffStart",type:"number",min:0,value:z(t.biasTimeCutOff[0]),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{biasTimeCutOff:[parseFloat(e.target.value),t.biasTimeCutOff[1]]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"biasTimeCutOffEnd",children:"End"}),Object(d.jsx)("input",{id:"biasTimeCutOffEnd",type:"number",min:t.biasTimeCutOff[0],value:z(t.biasTimeCutOff[1]),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{biasTimeCutOff:[t.biasTimeCutOff[0],parseFloat(e.target.value)]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]})]})]}),Object(d.jsxs)("div",{children:[Object(d.jsx)("p",{children:"Useful data time cut off (seconds)"}),Object(d.jsxs)("div",{className:"mt-2 flex space-x-4",children:[Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"timeCutOffStart",children:"Start"}),Object(d.jsx)("input",{id:"timeCutOffStart",type:"number",min:0,value:z(t.timeCutOff[0]),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{timeCutOff:[parseFloat(e.target.value),t.timeCutOff[1]]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(d.jsxs)("div",{className:"space-x-2",children:[Object(d.jsx)("label",{htmlFor:"timeCutOffEnd",children:"End"}),Object(d.jsx)("input",{id:"timeCutOffEnd",type:"number",min:t.timeCutOff[0],value:z(t.timeCutOff[1]),onChange:function(e){a(Object(D.a)(Object(D.a)({},t),{},{timeCutOff:[t.timeCutOff[0],parseFloat(e.target.value)]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]})]})]})]})},w=function(){var e=u().generatedDisplacement,t=Object(n.useMemo)((function(){if("undefined"!==typeof e){var t=e.size()[0],a=Object(x.h)(e,3),n=a.subset(Object(x.c)(Object(x.g)(0,t),0)).toArray().flat();return{sampleSize:t,travelTime:n[t-1]-n[0],startPoint:a.subset(Object(x.c)(0,[1,2,3])).toArray().flat(),endPoint:a.subset(Object(x.c)(t-1,[1,2,3])).toArray().flat()}}return{sampleSize:0,travelTime:0,startPoint:[0,0,0],endPoint:[0,0,0]}}),[e]),a=function(e){return e.reduce((function(e,t,a){return 0===a?"".concat(t):"".concat(e,", ").concat(t)}),"")};return Object(d.jsxs)("div",{className:"space-y-4",children:[Object(d.jsxs)("p",{children:["Sample size: ",t.sampleSize]}),Object(d.jsxs)("p",{children:["Travel time: ",t.travelTime,"s"]}),Object(d.jsx)("p",{children:"Start point (x, y, z): ".concat(a(t.startPoint))}),Object(d.jsx)("p",{children:"End point (x, y, z): ".concat(a(t.endPoint))})]})};var M=function(){var e=Object(n.useState)(),t=Object(i.a)(e,2),a=t[0],c=t[1],s=Object(n.useState)(),l=Object(i.a)(s,2),u=l[0],f=l[1],b=Object(n.useState)(),m=Object(i.a)(b,2),O=m[0],p=m[1],x=Object(n.useState)(0),y=Object(i.a)(x,2),g=y[0],C=y[1],D=Object(n.useState)(r),z=Object(i.a)(D,2),M=z[0],R=z[1];return Object(d.jsx)(o.Provider,{value:{zipFile:a,setZipFile:c,rotationMatrixData:u,setRotationMatrixData:f,generatedDisplacement:O,setGeneratedDisplacement:p,dataRevision:g,setDataRevision:C,algorithmParameters:M,setAlgorithmParameters:R},children:Object(d.jsxs)("div",{className:"container mx-auto py-8 space-y-8",children:[Object(d.jsxs)("div",{className:"space-y-4",children:[Object(d.jsx)("h3",{className:"text-3xl",children:"Zip File Upload"}),Object(d.jsx)(j,{})]}),Object(d.jsxs)("div",{className:"space-y-4",children:[Object(d.jsx)("h3",{className:"text-3xl",children:"Algorithm Parameters"}),Object(d.jsx)(F,{})]}),Object(d.jsx)(h,{}),Object(d.jsx)("div",{className:"flex justify-center",children:Object(d.jsx)(v,{})}),"undefined"!==typeof O?Object(d.jsxs)("div",{className:"space-y-4",children:[Object(d.jsx)("h3",{className:"text-3xl",children:"Results"}),Object(d.jsx)("h4",{className:"text-xl",children:"Information"}),Object(d.jsx)(w,{}),Object(d.jsx)("h4",{className:"text-xl",children:"Plots"}),Object(d.jsx)(N,{})]}):null]})})},R=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,56)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};Object(s.render)(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(M,{})}),document.getElementById("root")),R()}},[[53,1,2]]]);
//# sourceMappingURL=main.81c5c45a.chunk.js.map
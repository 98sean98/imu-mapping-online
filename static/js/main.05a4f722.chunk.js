(this["webpackJsonpimu-mapping-online"]=this["webpackJsonpimu-mapping-online"]||[]).push([[0],{29:function(e,t,a){},46:function(e,t){},53:function(e,t,a){"use strict";a.r(t);var n,c=a(2),s=a.n(c),i=a(23),r=(a(29),a(3));!function(e){e.NO_DATA="NO_DATA",e.DATA_LOADED="DATA_LOADED",e.RUNNING_ALGORITHM="RUNNING_ALGORITHM",e.RESULTS_OBTAINED="RESULTS_OBTAINED"}(n||(n={}));var o={shouldCorrectWithBiasRotM:!0,frequency:50,assumedConstantVelocity:.15,biasTimeCutOff:[0,30],timeCutOff:[30,60]},l={zipFile:void 0,setZipFile:function(){},rotationMatrixData:void 0,setRotationMatrixData:function(){},generatedDisplacement:void 0,setGeneratedDisplacement:function(){},dataRevision:0,setDataRevision:function(){},algorithmParameters:o,setAlgorithmParameters:function(){},stage:n.NO_DATA,setStage:function(){}},u=Object(c.createContext)(l),d=function(){return Object(c.useContext)(u)},j=a(0),f=function(){var e=d(),t=e.zipFile,a=e.setZipFile,n=Object(c.useState)(!1),s=Object(r.a)(n,2),i=s[0],o=s[1],l=Object(c.useState)(0),u=Object(r.a)(l,2),f=u[0],b=u[1];return Object(j.jsxs)("div",{className:"w-full h-64 border-2 border-gray-600 border-dashed rounded-lg flex flex-col items-center justify-center text-center relative overflow-hidden",onDragEnter:function(e){e.preventDefault(),e.stopPropagation(),o(!0),b((function(e){return e+1}))},onDragLeave:function(e){e.preventDefault(),e.stopPropagation();var t=f-1;0===t&&o(!1),b(t)},onDragOver:function(e){e.preventDefault(),e.stopPropagation()},onDrop:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.items&&e.dataTransfer.items.length>0&&(a(e.dataTransfer.files[0]),e.dataTransfer.clearData(),b(0)),o(!1)},children:[i?Object(j.jsx)("div",{className:"absolute inset-0 z-10 bg-gray-300 bg-opacity-75 flex items-center justify-center",children:Object(j.jsx)("p",{children:"Drop me!"})}):null,Object(j.jsxs)("p",{className:"font-medium text-gray-400",children:["undefined"!==typeof t?"".concat(t.name):"Drop a .zip file"," "]}),Object(j.jsxs)("div",{className:"mt-3",children:[Object(j.jsx)("label",{htmlFor:"file",className:"text-xs button cursor-pointer",children:"undefined"===typeof t?"Choose a file":"Choose another file"}),Object(j.jsx)("input",{id:"file",className:"hidden",type:"file",onChange:function(e){null!=e.target.files&&a(e.target.files[0])}})]})]})},b=a(15),O=a.n(b),m=a(20),p=a(24),x=a.n(p),h=a(55),v=function(){var e=d(),t=e.zipFile,a=e.setRotationMatrixData,s=e.setGeneratedDisplacement,i=e.setStage,o=Object(c.useState)([]),l=Object(r.a)(o,2),u=l[0],f=l[1];return Object(c.useEffect)((function(){"undefined"!==typeof t&&(new x.a).loadAsync(t).then(function(){var e=Object(m.a)(O.a.mark((function e(t){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(t.files).map(function(){var e=Object(m.a)(O.a.mark((function e(t){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.async("text");case 2:return a=e.sent,e.abrupt("return",{name:t.name,date:t.date,content:a});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:a=e.sent,f(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}),[t]),Object(c.useEffect)((function(){if("undefined"!==typeof u){var e=u.find((function(e){return e.name.includes("matrix.csv")}));if("undefined"!==typeof e){var t=e.content.split("\n");t.splice(0,1),t.splice(t.length-1,1);for(var c=[],r=[],o=t.length,l=0;l<o;l++){var d=t.splice(0,1)[0].split(",").map((function(e){return parseFloat(e)}));c.push(d.splice(0,1)[0]);for(var j=[],f=0;f<3;f++){var b=d.splice(0,3);j.push(b)}r.push(Object(h.e)(j))}a({time:c,rotationMatrix:r}),s(void 0),i(n.DATA_LOADED)}}}),[u,a,s,i]),Object(j.jsx)(j.Fragment,{})},y=a(7),g=function(){var e=d(),t=e.rotationMatrixData,a=e.setGeneratedDisplacement,s=e.setDataRevision,i=e.algorithmParameters,o=e.stage,l=e.setStage,u=Object(c.useCallback)((function(){if("undefined"!==typeof t){var e=t.time,n=t.rotationMatrix,c=i.shouldCorrectWithBiasRotM,r=i.frequency,o=i.assumedConstantVelocity,l=i.biasTimeCutOff,u=i.timeCutOff,d=Object(h.f)(l,r),j=n.slice(d[0],d[1]),f=j.reduce((function(e,t){return Object(h.a)(e,t)}),Object(h.k)(3,3)),b=Object(h.b)(f,j.length),O=Object(h.d)(b),m=Object(h.e)([[1,0,0],[0,1,0],[0,0,1]]);m.subset(Object(h.c)([0,1],[0,1]),O.subset(Object(h.c)([0,1],[0,1]))),console.log({meanStationaryRotM:b,inverseMeanStationaryRotM:O,biasCorrectionRotM:m});for(var p=e.findIndex((function(e){return e>u[0]})),x=e.findIndex((function(e){return e>u[1]}),p),v=e.slice(p,x),g=n.slice(p,x),N=Object(h.j)(v,v[0]),C=N.map((function(e,t){return.5*(o+o)*(e-(t>0?N[t-1]:0))})),D=[],T=0;T<g.length;T++)if(0!==T){var A=D[T-1],R=C[T],S=g[T],z=c?Object(h.f)(m,S):S,M=Object(h.f)(z,Object(h.e)([[R],[0],[0]])),F=Object(h.a)(A,M);D.push(F)}else D.push(Object(h.e)([[0],[0],[0]]));for(var w=Object(h.e)([]),E=0;E<D.length;E++){var P=N[E],I=D[E].toArray().flat();I[1]=-1*I[1];var _=Object(h.e)([P].concat(Object(y.a)(I)));w.subset(Object(h.c)(E,Object(h.g)(0,4)),_)}a(w),s((function(e){return e+1})),console.log("finished running algorithm!")}}),[t,i,a,s]),f=Object(c.useState)(!1),b=Object(r.a)(f,2),O=b[0],m=b[1],p=Object(c.useCallback)((function(){return m(!0)}),[]);Object(c.useEffect)((function(){if(O){l(n.RUNNING_ALGORITHM);var e=setTimeout((function(){u(),l(n.RESULTS_OBTAINED),m(!1)}),200);return function(){return clearTimeout(e)}}}),[O,u,l]);var x=Object(c.useMemo)((function(){return o===n.DATA_LOADED?"Run Algorithm":o===n.RUNNING_ALGORITHM?"Running Algorithm":o===n.RESULTS_OBTAINED?"Run Again":void 0}),[o]);return Object(j.jsx)(j.Fragment,{children:"undefined"!==typeof t?Object(j.jsx)("button",{className:"button",onClick:p,disabled:o===n.RUNNING_ALGORITHM,children:x}):null})},N=a(16),C=a.n(N),D=function(){var e=d(),t=e.generatedDisplacement,a=e.dataRevision,n=Object(c.useMemo)((function(){if("undefined"!==typeof t){var e=t.size()[0];return{t:Object(h.i)(t,Object(h.c)(Object(h.g)(0,e),0)).toArray().flat(),x:Object(h.i)(t,Object(h.c)(Object(h.g)(0,e),1)).toArray().flat(),y:Object(h.i)(t,Object(h.c)(Object(h.g)(0,e),2)).toArray().flat(),z:Object(h.i)(t,Object(h.c)(Object(h.g)(0,e),3)).toArray().flat()}}return{t:[],x:[],y:[],z:[]}}),[t]);return Object(j.jsxs)("div",{className:"flex flex-col items-center space-y-8 px-4",children:[Object(j.jsx)("div",{className:"w-full md:w-4/5 lg:w-3/5",children:Object(j.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:n.t,y:n.x,type:"scatter",mode:"lines",line:{color:"red"},name:"x"},{x:n.t,y:n.y,type:"scatter",mode:"lines",line:{color:"blue"},name:"y"},{x:n.t,y:n.z,type:"scatter",mode:"lines",line:{color:"green"},name:"z"}],layout:{autosize:!0,title:"Dynamics"}})}),Object(j.jsxs)("div",{className:"w-full lg:flex lg:justify-around space-y-4 lg:space-x-4 lg:space-y-0",children:[Object(j.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:n.y,y:n.x,type:"scatter",mode:"lines",line:{color:"red"}}],layout:{autosize:!0,title:"2D Map",xaxis:{autorange:!1}}}),Object(j.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:n.x,y:n.z,type:"scatter",mode:"lines",line:{color:"blue"}}],layout:{autosize:!0,title:"Elevation",yaxis:{autorange:!1}}})]}),Object(j.jsx)("div",{className:"w-full md:w-4/5 lg:w-3/5",children:Object(j.jsx)(C.a,{useResizeHandler:!0,revision:a,className:"w-full h-full",config:{responsive:!0},data:[{x:n.y,y:n.x,z:n.z,type:"scatter3d",mode:"lines",line:{color:"red",width:4}}],layout:{autosize:!0,title:"3D Map",scene:{camera:{eye:{x:-1.25,y:-1.25,z:1.25}},aspectmode:"cube",dragmode:!1}}})})]})},T=a(5),A=function(e){return isNaN(e)?"":e},R=function(){var e=d(),t=e.algorithmParameters,a=e.setAlgorithmParameters;return Object(j.jsxs)("div",{className:"space-y-4",children:[Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"shouldCorrectWithBiasRotM",children:"Should correct bias"}),Object(j.jsx)("input",{id:"shouldCorrectWithBiasRotM",type:"checkbox",checked:t.shouldCorrectWithBiasRotM,onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{shouldCorrectWithBiasRotM:e.target.checked}))}})]}),Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"frequency",children:"Data collection frequency (Hz)"}),Object(j.jsx)("input",{id:"frequency",type:"number",min:1,max:400,value:A(t.frequency),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{frequency:parseInt(e.target.value)}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"assumedConstantVelocity",children:"Assumed constant velocity (m/s)"}),Object(j.jsx)("input",{id:"assumedConstantVelocity",type:"number",min:0,value:A(t.assumedConstantVelocity),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{assumedConstantVelocity:parseFloat(e.target.value)}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"Bias time cut off (seconds)"}),Object(j.jsxs)("div",{className:"mt-2 flex space-x-4",children:[Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"biasTimeCutOffStart",children:"Start"}),Object(j.jsx)("input",{id:"biasTimeCutOffStart",type:"number",min:0,value:A(t.biasTimeCutOff[0]),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{biasTimeCutOff:[parseFloat(e.target.value),t.biasTimeCutOff[1]]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"biasTimeCutOffEnd",children:"End"}),Object(j.jsx)("input",{id:"biasTimeCutOffEnd",type:"number",min:t.biasTimeCutOff[0],value:A(t.biasTimeCutOff[1]),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{biasTimeCutOff:[t.biasTimeCutOff[0],parseFloat(e.target.value)]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]})]})]}),Object(j.jsxs)("div",{children:[Object(j.jsx)("p",{children:"Useful data time cut off (seconds)"}),Object(j.jsxs)("div",{className:"mt-2 flex space-x-4",children:[Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"timeCutOffStart",children:"Start"}),Object(j.jsx)("input",{id:"timeCutOffStart",type:"number",min:0,value:A(t.timeCutOff[0]),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{timeCutOff:[parseFloat(e.target.value),t.timeCutOff[1]]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]}),Object(j.jsxs)("div",{className:"space-x-2",children:[Object(j.jsx)("label",{htmlFor:"timeCutOffEnd",children:"End"}),Object(j.jsx)("input",{id:"timeCutOffEnd",type:"number",min:t.timeCutOff[0],value:A(t.timeCutOff[1]),onChange:function(e){a(Object(T.a)(Object(T.a)({},t),{},{timeCutOff:[t.timeCutOff[0],parseFloat(e.target.value)]}))},className:"w-40 border border-gray-600 rounded py-1 px-2"})]})]})]})]})},S=function(){var e=d().generatedDisplacement,t=Object(c.useMemo)((function(){if("undefined"!==typeof e){var t=e.size()[0],a=Object(h.h)(e,3),n=a.subset(Object(h.c)(Object(h.g)(0,t),0)).toArray().flat();return{sampleSize:t,travelTime:n[t-1]-n[0],startPoint:a.subset(Object(h.c)(0,[1,2,3])).toArray().flat(),endPoint:a.subset(Object(h.c)(t-1,[1,2,3])).toArray().flat()}}return{sampleSize:0,travelTime:0,startPoint:[0,0,0],endPoint:[0,0,0]}}),[e]),a=function(e){return e.reduce((function(e,t,a){return 0===a?"".concat(t):"".concat(e,", ").concat(t)}),"")};return Object(j.jsxs)("div",{className:"space-y-4",children:[Object(j.jsxs)("p",{children:["Sample size: ",t.sampleSize]}),Object(j.jsxs)("p",{children:["Travel time: ",t.travelTime,"s"]}),Object(j.jsx)("p",{children:"Start point (x, y, z): ".concat(a(t.startPoint))}),Object(j.jsx)("p",{children:"End point (x, y, z): ".concat(a(t.endPoint))})]})};var z=function(){var e=Object(c.useState)(),t=Object(r.a)(e,2),a=t[0],s=t[1],i=Object(c.useState)(),l=Object(r.a)(i,2),d=l[0],b=l[1],O=Object(c.useState)(),m=Object(r.a)(O,2),p=m[0],x=m[1],h=Object(c.useState)(0),y=Object(r.a)(h,2),N=y[0],C=y[1],T=Object(c.useState)(o),A=Object(r.a)(T,2),z=A[0],M=A[1],F=Object(c.useState)(n.NO_DATA),w=Object(r.a)(F,2),E=w[0],P=w[1];return Object(j.jsx)(u.Provider,{value:{zipFile:a,setZipFile:s,rotationMatrixData:d,setRotationMatrixData:b,generatedDisplacement:p,setGeneratedDisplacement:x,dataRevision:N,setDataRevision:C,algorithmParameters:z,setAlgorithmParameters:M,stage:E,setStage:P},children:Object(j.jsxs)("div",{className:"container mx-auto py-8 px-4 space-y-8",children:[Object(j.jsxs)("div",{className:"space-y-4",children:[Object(j.jsx)("h3",{className:"text-3xl",children:"Zip File Upload"}),Object(j.jsx)(f,{})]}),Object(j.jsxs)("div",{className:"space-y-4",children:[Object(j.jsx)("h3",{className:"text-3xl",children:"Algorithm Parameters"}),Object(j.jsx)(R,{})]}),Object(j.jsx)(v,{}),Object(j.jsx)("div",{className:"flex justify-center",children:Object(j.jsx)(g,{})}),E===n.RESULTS_OBTAINED?Object(j.jsxs)("div",{className:"space-y-4",children:[Object(j.jsx)("h3",{className:"text-3xl",children:"Results"}),Object(j.jsx)("h4",{className:"text-xl",children:"Information"}),Object(j.jsx)(S,{}),Object(j.jsx)("h4",{className:"text-xl",children:"Plots"}),Object(j.jsx)(D,{})]}):null]})})},M=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,56)).then((function(t){var a=t.getCLS,n=t.getFID,c=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),c(e),s(e),i(e)}))};Object(i.render)(Object(j.jsx)(s.a.StrictMode,{children:Object(j.jsx)(z,{})}),document.getElementById("root")),M()}},[[53,1,2]]]);
//# sourceMappingURL=main.05a4f722.chunk.js.map